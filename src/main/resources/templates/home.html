<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
<meta charset="UTF-8">
<title>Money Transfer</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">
<link rel="stylesheet" href="css/home.css">
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
</head>

<body>
	<div class="container">
		<div class="row header">
			<h1>Money Transfer &nbsp;</h1>
			<h3>Transfer the money with just one click!</h3>
		</div>
		<div class="row body">
			<form action="#" th:action="@{/transfer}" th:object="${transfer}" method="post">
				<ul>
					<li>
						<div>
						<p class="left">
							<label for="account_number">Receiver's A/C Number</label> <small><input
								type="text" th:field="*{accountNumber}" name="account_number" placeholder="Account Number" /></small>
							<br>
						</p>
						</div>

						<div>
						<p class="left">
							<label for="sender_account_number">Sender's A/C Number</label> <small><input
								th:field="*{senderNumber}" type="text" name="sender_account_number"
								placeholder="Sender's Account Number" /></small> <br>
						</p>						
						</div>
						
						<div>
						<p class="left">
							<label for="amount">Transfer Amount</label> <small><input type="text" name="amount"
								th:field="*{amount}" placeholder="Transfer Amount" /></small> <br>
						</p>
						</div>
					</li>
					<li><input class="btn btn-submit" type="submit" value="Submit" id="btn-submit" /> <small>or
							press <strong>enter</strong>
					</small></li>
				</ul>
			</form>
		</div>
	</div>

	<script type="text/javascript">
		window.addEventListener('load', function() {
			retrieveToken();
			checkStatus();
		});

		function checkStatus() {
			if (getParameterByName("status")
					&& getParameterByName("status") === "failed") {
				alert("Failure\nThe transaction was not completed!");

			} else if (getParameterByName("status")
					&& getParameterByName("status") === "success") {
				alert("Success\nThe transaction was completed successfully!!!");

			}
		}
		function getParameterByName(name, url) {
			if (!url)
				url = window.location.href;
			name = name.replace(/[\[\]]/g, '\\$&');
			var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'), results = regex
					.exec(url);
			if (!results)
				return null;
			if (!results[2])
				return '';
			return decodeURIComponent(results[2].replace(/\+/g, ' '));
		}

		function retrieveToken() {
			console.log('Retrieving token...');
			$
					.ajax({
						type : "GET",
						url : "/token",
						contentType : "text/json",
						success : function(data) {
							console.log("retrieved token.. ", data);
							$("#btn-submit")
									.before(
											'<input type="hidden" name="csrf" value="' + data + '">');
						},
						error : function() {
							console.log("Error in loading token...");
						}
					});
		}
	</script>
</body>

</html>
